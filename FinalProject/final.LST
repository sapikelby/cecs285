A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN final.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE final.A51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     
                       2     
                       3     
                       4     
                       5     
                       6     
                       7     
                       8     
                       9     
0000                  10             ORG 0
                      11             ;MOV TMOD, #20H
0000 758920           12             MOV TMOD, #20H
0003 758DFD           13             MOV TH1, #0FDH
0006 759850           14             MOV SCON, #50H
                      15             ;CLR A
0009                  16     MAIN:
0009 120047           17             LCALL MOVING_DATA ; MOVE DATA INTO RAM
                      18     
000C                  19     DISPLAY_MENU:    
                      20         ;LCALL RECEIVE1BYTE
                      21             ;MOV B, A
000C 900126           22             MOV DPTR, #MSG_HEAD
000F 1200AD           23             LCALL SEND1LINE
0012 12008D           24             LCALL RECEIVE1BYTE
0015 12001A           25             LCALL CHECK_DISPLAY_ALL
                      26             ;MOV B, A
                      27             
                      28             ;MOV A, B
                      29             ;LCALL SEND1BYTE
                      30             ;MOV DPTR, #MSG_END
                      31             ;LCALL SEND1LINE
0018 80F2             32         SJMP DISPLAY_MENU
                      33     
001A                  34     CHECK_DISPLAY_ALL: 
                      35                     ; ASCII REPRESENTATION OF NUMBER PRESSED GET PUSHED TO PORT 1
                      36                     ; ASCII REP ON P1 == 31H
                      37                     ; COMPARE PORT 1 TO 31H (HEX VAL OF 1) AND SO ON...
001A 8590F0           38                     MOV B, P1
001D 7431             39                     MOV A, #31H
001F B5F005           40                     CJNE A, B, CHECK_AVG ; IF NOT EQUAL TO HEX VALUE
                      41                     ;JNB P1.0, CHECK_AVG  ; JUMP if P0.1 is low, otherwise CHECK_AVG
                      42                     ;MOV DPTR, #DATA_STRING
                      43                     ;MOV DPTR, #DATA_VALUES
                      44                     ;LCALL SEND1LINE
0022 1200E6           45                     LCALL DISPLAY_ASCII
0025 80E5             46                     SJMP DISPLAY_MENU                
                      47     
0027                  48     CHECK_AVG:
                      49                     ; ASCII REP ON P1 == 32H
0027 8590F0           50                     MOV B, P1
002A 7432             51                     MOV A, #32H
002C B5F008           52                     CJNE A, B, CHECK_MIN ; IF NOT EQUAL TO HEX VALUE
002F 120074           53                     LCALL AVG
                      54                     ;LCALL SEND1BYTE
                      55                     ;MOV A, @R0 ; MOVE WHAT IS IN LOCATION 48H INTO A
0032 1200C3           56                     LCALL DISPLAY_AVG
0035 80D5             57                     SJMP DISPLAY_MENU
                      58     
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     2

0037                  59     CHECK_MIN: 
                      60                     ; ASCII REP ON P1 == 33H
0037 8590F0           61                     MOV B, P1
003A 7433             62                     MOV A, #33H
003C B5F0CD           63                     CJNE A, B, DISPLAY_MENU  ;COMPARE A AND B
003F 120057           64                     LCALL MINIMUM
                      65                     ;MOV A, @R0
0042 1200C3           66                     LCALL DISPLAY_AVG
0045 80C5             67                     SJMP DISPLAY_MENU
                      68                     ;MOV R0, A
                      69                     
                      70     
                      71     ;DISPLAY_ORIGINAL: 
                      72     ;               MOV DPTR, #DATA_STRING
                      73     ;               LCALL SEND1LINE
                      74     
                      75     ; --- INSERT DATA INTO RAM
0047                  76     MOVING_DATA:
0047 E4               77                     CLR A
0048 7840             78                     MOV R0, #40H ; destination address
004A 7A08             79                     MOV R2, #8 ; counter
004C 90011D           80                     MOV DPTR, #DATA_VALUES  
                      81     
004F                  82     INSERT:
004F E4               83                     CLR A
0050 93               84                     MOVC A, @A+DPTR
0051 F6               85                     MOV @R0, A
                      86     
0052 A3               87                     INC DPTR
0053 08               88                     INC R0
                      89                     
0054 DAF9             90                     DJNZ R2, INSERT
0056 22               91                     RET
                      92     ; --- INSERT DATA INTO RAM ENDS
                      93     
                      94     ; ---- MIN ROUTINE
0057                  95     MINIMUM:
0057 784A             96                     MOV R0, #4AH
0059 7940             97                     MOV R1, #40H
005B 7A08             98                     MOV R2, #8
005D 87F0             99                     MOV B, @R1 ; ASSUME 1ST ELEMENT IS THE MIN VALUE
                     100                             
005F E4              101                     CLR A
0060                 102     MINLOOP:
0060 E7              103                     MOV A, @R1
0061 B5F000          104                     CJNE A, B, LOOP1  ;COMPARE A AND B
                     105                     
0064 5007            106     LOOP1:  JNC LOOP2  ; JUMP IF A > B
0066 F5F0            107                     MOV B, A ; ELSE MOVE A TO B (A < B) 
0068 09              108                     INC R1
                     109                     
                     110                     
0069 DAF5            111                     DJNZ R2, MINLOOP
006B 8003            112                     SJMP FINALSTEP
006D                 113     LOOP2: 
006D 09              114                     INC R1
                     115                     ;MOV B, A
006E DAF0            116                     DJNZ R2, MINLOOP
                     117                     
0070                 118     FINALSTEP:      
0070 E5F0            119                     MOV A, B
0072 F6              120                     MOV @R0, A
0073 22              121                     RET
                     122     ; ---- END ROUTINE
                     123     
                     124     
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     3

0074                 125     AVG:
0074 E4              126                     CLR A
0075 754800          127                     MOV 48H, #0
                     128                     ;MOV R1, #40H ; destination address
0078 7848            129                     MOV R0, #48H  ; KEEP VALUE
007A 7A08            130                     MOV R2, #8
007C 75F008          131                     MOV B, #8
007F 90011D          132                     MOV DPTR, #DATA_VALUES
0082                 133     AGAIN2: 
0082 E4              134                     CLR A
0083 93              135                     MOVC A, @A+DPTR
                     136                     ;MOV @R1, A
0084 26              137                     ADD A, @R0
0085 F6              138                     MOV @R0, A
                     139                     
                     140                     ;MOV @RO, A
                     141                     ;INC R1
0086 A3              142                     INC DPTR
                     143                     
                     144                     ;INC R0  ; increment the location to which you are adding the string at pos
                             ition(i)
0087 DAF9            145                     DJNZ R2, AGAIN2
                     146                     
0089 E6              147                     MOV A, @R0
008A 84              148                     DIV AB
008B F6              149                     MOV @R0, A 
008C 22              150                     RET
                     151     
                     152     
                     153     
                     154     
008D                 155     RECEIVE1BYTE:
008D C298            156             CLR RI
008F D28E            157             SETB TR1
0091                 158     STAY1:  
0091 A298            159             MOV C,RI
0093 50FC            160             JNC STAY1
0095 E599            161             MOV A, SBUF              ; move what we just received to register A
0097 F590            162         MOV P1, A    
0099 C298            163             CLR RI
009B C28E            164             CLR TR1
009D 22              165             RET
                     166             
009E                 167     SEND1BYTE:
009E C299            168             CLR TI
00A0 D28E            169             SETB TR1
00A2 F599            170             MOV SBUF, A
00A4                 171     STAY2:  
00A4 A299            172             MOV C,TI
00A6 50FC            173             JNC STAY2
00A8 C299            174         CLR TI
00AA C28E            175             CLR TR1
00AC 22              176         RET
                     177             
00AD                 178     SEND1LINE:  ; WORKS ONLY FOR STRINGS
00AD C299            179             CLR TI
00AF D28E            180             SETB TR1
00B1 E4              181     AGAIN:  CLR A
00B2 93              182             MOVC A, @A+DPTR
00B3 600D            183             JZ DONE
00B5 A3              184             INC DPTR
00B6 F599            185             MOV SBUF, A
00B8                 186     STAY3:  
00B8 A299            187             MOV C,TI
00BA 50FC            188             JNC STAY3
00BC C299            189         CLR TI
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     4

00BE 80F1            190             SJMP AGAIN
00C0 C28E            191             CLR TR1
00C2 22              192     DONE:RET
                     193     
                     194     
                     195     ;---- DISPLAY ONE NUMBER ONLY
00C3                 196     DISPLAY_AVG:
00C3 C299            197             CLR TI
00C5 D28E            198             SETB TR1
00C7 E4              199             CLR A
                     200             ;MOV R0, #48H
00C8 E6              201             MOV A, @R0
                     202             ;JZ STAY_DONE
00C9 75F00A          203             MOV B, #10
00CC 84              204             DIV AB 
00CD 2430            205             ADD A, #30H 
00CF F599            206             MOV SBUF, A
                     207     
00D1                 208     STAY_AVG:       
00D1 A299            209             MOV C,TI
00D3 50FC            210             JNC STAY_AVG
00D5 C299            211         CLR TI      
                     212             
00D7 E5F0            213             MOV A, B ; B IS 7
00D9 2430            214             ADD A, #30H ; 37H
00DB F599            215             MOV SBUF, A
                     216     
00DD                 217     STAY_AVG1:      
00DD A299            218             MOV C,TI
00DF 50FC            219             JNC STAY_AVG1
00E1 C299            220         CLR TI      
                     221             
                     222     ;STAY_DONE:     
                     223     ;       MOV C,TI
                     224     ;       JNC STAY_DONE
                     225      ;   CLR TI     
                     226             
00E3 C28E            227             CLR TR1
00E5 22              228             RET
                     229     ;----
                     230     
00E6                 231     DISPLAY_ASCII:  ;CONVERTS NUMBERS TO ASCII REPRESENTATION FOR UART
00E6 C299            232             CLR TI
00E8 D28E            233             SETB TR1
                     234             ;MOV DPTR, #DATA_VALUES
00EA 7840            235             MOV R0, #40H
00EC 90011D          236             MOV DPTR, #DATA_VALUES
                     237             
00EF                 238     AGAIN1: 
00EF E4              239             CLR A
00F0 93              240             MOVC A, @A+DPTR
00F1 6029            241             JZ DONE1
00F3 75F00A          242             MOV B, #10
00F6 84              243             DIV AB ; EX 17-- A IS NOW 1
00F7 2430            244             ADD A, #30H ; 31H
00F9 F599            245             MOV SBUF, A
                     246             
00FB                 247     STAY4:  
00FB A299            248             MOV C,TI
00FD 50FC            249             JNC STAY4
00FF C299            250         CLR TI      
                     251             
0101 E5F0            252             MOV A, B ; B IS 7
0103 2430            253             ADD A, #30H ; 37H
0105 F599            254             MOV SBUF, A
0107                 255     STAY5:  
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     5

0107 A299            256             MOV C,TI
0109 50FC            257             JNC STAY5
010B C299            258         CLR TI
                     259     
                     260     ; --- DISPLAY SPACE
010D 7420            261             MOV A, #20H
010F F599            262             MOV SBUF, A
0111                 263     STAY_MIDDLE:    
0111 A299            264             MOV C,TI
0113 50FC            265             JNC STAY_MIDDLE
0115 C299            266         CLR TI
                     267     
                     268             ;JZ DONE
0117 A3              269             INC DPTR
                     270     
0118 80D5            271             SJMP AGAIN1
011A C28E            272             CLR TR1
011C 22              273     DONE1:RET
                     274     
                     275     
                     276     
                     277     
                     278     
                     279     
                     280     ;ADD:
                     281     ;               CLR A
                     282     ;               MOV R0, #40H ; destination address
                     283     ;               MOV R2, #8
                     284     ;AGAIN: MOV @R0, P0
                     285     ;               ADD A, @R0
                     286     ;               
                     287     ;               JNC SKIP
                     288     ;               INC 4BH ; increment 4BH for each carry (HIGH BYTE)
                     289     ;               
                     290     ;SKIP:  INC R0  ; increment the location to which you are adding the string at position(i)
                     291     ;               DJNZ R2, AGAIN
                     292     ;               MOV 4AH, A ; MOVE LOW BYTE INTO 4AH
                     293     ;               END
                     294     
                     295     ;DATA_STRING: DB "Here is the original data:", 0AH, "17, 37, 9, 18, 11, 26, 23, 43", 0AH, 0
                              
                     296     ;DATA_VALUES: DB "First", 17, 37, 9, 18, 11, 26, 23, 43  // TESTING THE FIRST STRING IS THE
                              ONLY THING DISPLAYED BC ALREADY IN ASCII
                     297     ;DATA_VALUES: DB 11H, 25H, 9H, 12H, 0BH, 1AH, 17H, 2BH
                     298     ;DATA_VALUES: DB 41H, 55H, 39H, 42H, 3BH, 4AH, 47H, 5BH ; DATA VALUES + 30 FOR ASCII REP
011D 11250912        299     DATA_VALUES: DB 17, 37, 9, 18, 11, 26, 23, 43, 0 
0121 0B1A172B                
0125 00                      
                     300     ;MSG_HEAD: DB "I received ",0
                     301     ;MSG_END: DB '!', 0AH, 0DH, 0 ;ODH for carriage return, 0AH for newline
                     302     ;MSG_HEAD: DB "I received ",0
0126 0A506C65        303     MSG_HEAD: DB 0AH, "Please select from the following:", 0AH, "1. Display original data", 0AH
                             , "2. Find and display average", 0AH, "3. Find and display maximum", 0AH, "4. Find and display minimum", 0AH, 0 
012A 61736520                
012E 73656C65                
0132 63742066                
0136 726F6D20                
013A 74686520                
013E 666F6C6C                
0142 6F77696E                
0146 673A0A31                
014A 2E204469                
014E 73706C61                
0152 79206F72                
0156 6967696E                
015A 616C2064                
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     6

015E 6174610A                
0162 322E2046                
0166 696E6420                
016A 616E6420                
016E 64697370                
0172 6C617920                
0176 61766572                
017A 6167650A                
017E 332E2046                
0182 696E6420                
0186 616E6420                
018A 64697370                
018E 6C617920                
0192 6D617869                
0196 6D756D0A                
019A 342E2046                
019E 696E6420                
01A2 616E6420                
01A6 64697370                
01AA 6C617920                
01AE 6D696E69                
01B2 6D756D0A                
01B6 00                      
                     304     ;1.     Display original data - a prompt should follow it saying "original data: …" 
                     305     ;2.     Find and display average
                     306     ;3.     Find and display maximum
                     307     ;4.     Find and display minimum
                     308     
                     309     ;MSG_END: DB '', 0AH, 0DH, 0 ;ODH for carriage return, 0AH for newline
                     310     
                     311             END
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                                     
                             
                             
A51 MACRO ASSEMBLER  FINAL                                                                05/08/2014 00:00:02 PAGE     7

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AGAIN. . . . . . .  C ADDR   00B1H   A   
AGAIN1 . . . . . .  C ADDR   00EFH   A   
AGAIN2 . . . . . .  C ADDR   0082H   A   
AVG. . . . . . . .  C ADDR   0074H   A   
B. . . . . . . . .  D ADDR   00F0H   A   
CHECK_AVG. . . . .  C ADDR   0027H   A   
CHECK_DISPLAY_ALL.  C ADDR   001AH   A   
CHECK_MIN. . . . .  C ADDR   0037H   A   
DATA_VALUES. . . .  C ADDR   011DH   A   
DISPLAY_ASCII. . .  C ADDR   00E6H   A   
DISPLAY_AVG. . . .  C ADDR   00C3H   A   
DISPLAY_MENU . . .  C ADDR   000CH   A   
DONE . . . . . . .  C ADDR   00C2H   A   
DONE1. . . . . . .  C ADDR   011CH   A   
FINALSTEP. . . . .  C ADDR   0070H   A   
INSERT . . . . . .  C ADDR   004FH   A   
LOOP1. . . . . . .  C ADDR   0064H   A   
LOOP2. . . . . . .  C ADDR   006DH   A   
MAIN . . . . . . .  C ADDR   0009H   A   
MINIMUM. . . . . .  C ADDR   0057H   A   
MINLOOP. . . . . .  C ADDR   0060H   A   
MOVING_DATA. . . .  C ADDR   0047H   A   
MSG_HEAD . . . . .  C ADDR   0126H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
RECEIVE1BYTE . . .  C ADDR   008DH   A   
RI . . . . . . . .  B ADDR   0098H.0 A   
SBUF . . . . . . .  D ADDR   0099H   A   
SCON . . . . . . .  D ADDR   0098H   A   
SEND1BYTE. . . . .  C ADDR   009EH   A   
SEND1LINE. . . . .  C ADDR   00ADH   A   
STAY1. . . . . . .  C ADDR   0091H   A   
STAY2. . . . . . .  C ADDR   00A4H   A   
STAY3. . . . . . .  C ADDR   00B8H   A   
STAY4. . . . . . .  C ADDR   00FBH   A   
STAY5. . . . . . .  C ADDR   0107H   A   
STAY_AVG . . . . .  C ADDR   00D1H   A   
STAY_AVG1. . . . .  C ADDR   00DDH   A   
STAY_MIDDLE. . . .  C ADDR   0111H   A   
TH1. . . . . . . .  D ADDR   008DH   A   
TI . . . . . . . .  B ADDR   0098H.1 A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR1. . . . . . . .  B ADDR   0088H.6 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
