A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN final.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE final.A51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     
                       2     
                       3     
                       4     
                       5     
                       6     
                       7     
                       8     
                       9     
0000                  10             ORG 0
                      11             ;MOV TMOD, #20H
0000 758920           12             MOV TMOD, #20H
0003 758DFD           13             MOV TH1, #0FDH
0006 759850           14             MOV SCON, #50H
                      15             ;CLR A
0009                  16     DISPLAY_MENU:    
                      17         ;LCALL RECEIVE1BYTE
                      18             ;MOV B, A
0009 90011E           19             MOV DPTR, #MSG_HEAD
000C 120065           20             LCALL SEND1LINE
000F 120045           21             LCALL RECEIVE1BYTE
0012 120017           22             LCALL CHECK_DISPLAY_ALL
                      23             ;MOV B, A
                      24             
                      25             ;MOV A, B
                      26             ;LCALL SEND1BYTE
                      27             ;MOV DPTR, #MSG_END
                      28             ;LCALL SEND1LINE
0015 80F2             29         SJMP DISPLAY_MENU
                      30     
0017                  31     CHECK_DISPLAY_ALL:                                                                         
                                                                                                                    
0017 309005           32                     JNB P1.0, CHECK_AVG  ; JUMP if P0.1 is low, otherwise CHECK_AVG
                      33                     ;MOV DPTR, #DATA_STRING
                      34                     ;MOV DPTR, #DATA_VALUES
                      35                     ;LCALL SEND1LINE
001A 1200A6           36                     LCALL DISPLAY_ASCII
001D 80EA             37                     SJMP DISPLAY_MENU                
                      38     
001F                  39     CHECK_AVG:
001F 3091E7           40                     JNB P1.1, DISPLAY_MENU ; JUMP if P0.2 is low, otherwise 
0022 12002B           41                     LCALL AVG
                      42                     ;LCALL SEND1BYTE
0025 E6               43                     MOV A, @R0 ; MOVE WHAT IS IN LOCATION 48H INTO A
0026 1200A6           44                     LCALL DISPLAY_ASCII
0029 80DE             45                     SJMP DISPLAY_MENU
                      46     
                      47     ;DISPLAY_ORIGINAL: 
                      48     ;               MOV DPTR, #DATA_STRING
                      49     ;               LCALL SEND1LINE
                      50     
002B                  51     AVG:
002B E4               52                     CLR A
002C 7940             53                     MOV R1, #40H ; destination address
002E 7848             54                     MOV R0, #48H  ; KEEP VALUE
0030 7A08             55                     MOV R2, #8
0032 75F008           56                     MOV B, #8
0035 900115           57                     MOV DPTR, #DATA_VALUES
A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     2

0038                  58     AGAIN2: 
0038 E4               59                     CLR A
0039 93               60                     MOVC A, @A+DPTR
003A F7               61                     MOV @R1, A
003B 26               62                     ADD A, @R0
003C F6               63                     MOV @R0, A
                      64                     
                      65                     ;MOV @RO, A
003D 09               66                     INC R1
003E A3               67                     INC DPTR
                      68                     
                      69                     ;INC R0  ; increment the location to which you are adding the string at pos
                             ition(i)
003F DAF7             70                     DJNZ R2, AGAIN2
                      71                     
0041 E6               72                     MOV A, @R0
0042 84               73                     DIV AB
0043 F6               74                     MOV @R0, A 
0044 22               75                     RET
                      76     
0045                  77     RECEIVE1BYTE:
0045 C298             78             CLR RI
0047 D28E             79             SETB TR1
0049                  80     STAY1:  
0049 A298             81             MOV C,RI
004B 50FC             82             JNC STAY1
004D E599             83             MOV A, SBUF              ; move what we just received to register A
004F F590             84         MOV P1, A    
0051 C298             85             CLR RI
0053 C28E             86             CLR TR1
0055 22               87             RET
                      88             
0056                  89     SEND1BYTE:
0056 C299             90             CLR TI
0058 D28E             91             SETB TR1
005A F599             92             MOV SBUF, A
005C                  93     STAY2:  
005C A299             94             MOV C,TI
005E 50FC             95             JNC STAY2
0060 C299             96         CLR TI
0062 C28E             97             CLR TR1
0064 22               98         RET
                      99             
0065                 100     SEND1LINE:  ; WORKS ONLY FOR STRINGS
0065 C299            101             CLR TI
0067 D28E            102             SETB TR1
0069 E4              103     AGAIN:  CLR A
006A 93              104             MOVC A, @A+DPTR
006B 600D            105             JZ DONE
006D A3              106             INC DPTR
006E F599            107             MOV SBUF, A
0070                 108     STAY3:  
0070 A299            109             MOV C,TI
0072 50FC            110             JNC STAY3
0074 C299            111         CLR TI
0076 80F1            112             SJMP AGAIN
0078 C28E            113             CLR TR1
007A 22              114     DONE:RET
                     115     
                     116     
                     117     ;---- DISPLAY AVG
007B                 118     DISPLAY_AVG:
007B C299            119             CLR TI
007D D28E            120             SETB TR1
007F E4              121             CLR A
                     122             ;MOV R0, #48H
A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     3

0080 E6              123             MOV A, @R0
0081 60F7            124             JZ DONE
0083 75F00A          125             MOV B, #10
0086 84              126             DIV AB 
0087 2430            127             ADD A, #30H 
0089 F599            128             MOV SBUF, A
                     129     
008B                 130     STAY_AVG:       
008B A299            131             MOV C,TI
008D 50FC            132             JNC STAY_AVG
008F C299            133         CLR TI      
                     134             
0091 E5F0            135             MOV A, B ; B IS 7
0093 2430            136             ADD A, #30H ; 37H
0095 F599            137             MOV SBUF, A
                     138     
0097                 139     STAY_AVG1:      
0097 A299            140             MOV C,TI
0099 50FC            141             JNC STAY_AVG1
009B C299            142         CLR TI      
                     143             
009D                 144     STAY_END:       
009D A299            145             MOV C,TI
009F 50FC            146             JNC STAY_END
00A1 C299            147         CLR TI      
                     148             
00A3 C28E            149             CLR TR1
00A5 22              150             RET
                     151     ;----
                     152     
00A6                 153     DISPLAY_ASCII:  ;CONVERTS NUMBERS TO ASCII REPRESENTATION FOR UART
00A6 C299            154             CLR TI
00A8 D28E            155             SETB TR1
00AA 900115          156             MOV DPTR, #DATA_VALUES
                     157             
00AD E4              158     AGAIN1: CLR A
00AE 93              159             MOVC A, @A+DPTR
00AF 60C9            160             JZ DONE
00B1 75F00A          161             MOV B, #10
00B4 84              162             DIV AB ; EX 17-- A IS NOW 1
00B5 2430            163             ADD A, #30H ; 31H
00B7 F599            164             MOV SBUF, A
                     165             
00B9                 166     STAY4:  
00B9 A299            167             MOV C,TI
00BB 50FC            168             JNC STAY4
00BD C299            169         CLR TI      
                     170             
00BF E5F0            171             MOV A, B ; B IS 7
00C1 2430            172             ADD A, #30H ; 37H
00C3 F599            173             MOV SBUF, A
00C5                 174     STAY5:  
00C5 A299            175             MOV C,TI
00C7 50FC            176             JNC STAY5
00C9 C299            177         CLR TI
                     178     
                     179     ; --- DISPLAY SPACE
00CB 7420            180             MOV A, #20H
00CD F599            181             MOV SBUF, A
00CF                 182     STAY_MIDDLE:    
00CF A299            183             MOV C,TI
00D1 50FC            184             JNC STAY_MIDDLE
00D3 C299            185         CLR TI
                     186     
                     187             ;JZ DONE
00D5 A3              188             INC DPTR
A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     4

                     189     
00D6 80D5            190             SJMP AGAIN1
00D8 C28E            191             CLR TR1
00DA 22              192     DONE1:RET
                     193     ;ADD:
                     194     ;               CLR A
                     195     ;               MOV R0, #40H ; destination address
                     196     ;               MOV R2, #8
                     197     ;AGAIN: MOV @R0, P0
                     198     ;               ADD A, @R0
                     199     ;               
                     200     ;               JNC SKIP
                     201     ;               INC 4BH ; increment 4BH for each carry (HIGH BYTE)
                     202     ;               
                     203     ;SKIP:  INC R0  ; increment the location to which you are adding the string at position(i)
                     204     ;               DJNZ R2, AGAIN
                     205     ;               MOV 4AH, A ; MOVE LOW BYTE INTO 4AH
                     206     ;               END
                     207     
00DB 48657265        208     DATA_STRING: DB "Here is the original data:", 0AH, "17, 37, 9, 18, 11, 26, 23, 43", 0AH, 0 
00DF 20697320                
00E3 74686520                
00E7 6F726967                
00EB 696E616C                
00EF 20646174                
00F3 613A0A31                
00F7 372C2033                
00FB 372C2039                
00FF 2C203138                
0103 2C203131                
0107 2C203236                
010B 2C203233                
010F 2C203433                
0113 0A00                    
                     209     ;DATA_VALUES: DB "First", 17, 37, 9, 18, 11, 26, 23, 43  // TESTING THE FIRST STRING IS THE
                              ONLY THING DISPLAYED BC ALREADY IN ASCII
                     210     ;DATA_VALUES: DB 11H, 25H, 9H, 12H, 0BH, 1AH, 17H, 2BH
                     211     ;DATA_VALUES: DB 41H, 55H, 39H, 42H, 3BH, 4AH, 47H, 5BH ; DATA VALUES + 30 FOR ASCII REP
0115 11250912        212     DATA_VALUES: DB 17, 37, 9, 18, 11, 26, 23, 43, 0 
0119 0B1A172B                
011D 00                      
                     213     ;MSG_HEAD: DB "I received ",0
                     214     ;MSG_END: DB '!', 0AH, 0DH, 0 ;ODH for carriage return, 0AH for newline
                     215     ;MSG_HEAD: DB "I received ",0
011E 0A506C65        216     MSG_HEAD: DB 0AH, "Please select from the following:", 0AH, "1. Display original data", 0AH
                             , "2. Find and display average", 0AH, "3. Find and display maximum", 0AH, "4. Find and display minimum", 0AH, 0 
0122 61736520                
0126 73656C65                
012A 63742066                
012E 726F6D20                
0132 74686520                
0136 666F6C6C                
013A 6F77696E                
013E 673A0A31                
0142 2E204469                
0146 73706C61                
014A 79206F72                
014E 6967696E                
0152 616C2064                
0156 6174610A                
015A 322E2046                
015E 696E6420                
0162 616E6420                
0166 64697370                
016A 6C617920                
016E 61766572                
A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     5

0172 6167650A                
0176 332E2046                
017A 696E6420                
017E 616E6420                
0182 64697370                
0186 6C617920                
018A 6D617869                
018E 6D756D0A                
0192 342E2046                
0196 696E6420                
019A 616E6420                
019E 64697370                
01A2 6C617920                
01A6 6D696E69                
01AA 6D756D0A                
01AE 00                      
                     217     ;1.     Display original data - a prompt should follow it saying "original data: …" 
                     218     ;2.     Find and display average
                     219     ;3.     Find and display maximum
                     220     ;4.     Find and display minimum
                     221     
                     222     ;MSG_END: DB '', 0AH, 0DH, 0 ;ODH for carriage return, 0AH for newline
                     223     
                     224             END
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                             
                                     
                             
                             
A51 MACRO ASSEMBLER  FINAL                                                                05/06/2014 15:20:26 PAGE     6

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AGAIN. . . . . . .  C ADDR   0069H   A   
AGAIN1 . . . . . .  C ADDR   00ADH   A   
AGAIN2 . . . . . .  C ADDR   0038H   A   
AVG. . . . . . . .  C ADDR   002BH   A   
B. . . . . . . . .  D ADDR   00F0H   A   
CHECK_AVG. . . . .  C ADDR   001FH   A   
CHECK_DISPLAY_ALL.  C ADDR   0017H   A   
DATA_STRING. . . .  C ADDR   00DBH   A   
DATA_VALUES. . . .  C ADDR   0115H   A   
DISPLAY_ASCII. . .  C ADDR   00A6H   A   
DISPLAY_AVG. . . .  C ADDR   007BH   A   
DISPLAY_MENU . . .  C ADDR   0009H   A   
DONE . . . . . . .  C ADDR   007AH   A   
DONE1. . . . . . .  C ADDR   00DAH   A   
MSG_HEAD . . . . .  C ADDR   011EH   A   
P1 . . . . . . . .  D ADDR   0090H   A   
RECEIVE1BYTE . . .  C ADDR   0045H   A   
RI . . . . . . . .  B ADDR   0098H.0 A   
SBUF . . . . . . .  D ADDR   0099H   A   
SCON . . . . . . .  D ADDR   0098H   A   
SEND1BYTE. . . . .  C ADDR   0056H   A   
SEND1LINE. . . . .  C ADDR   0065H   A   
STAY1. . . . . . .  C ADDR   0049H   A   
STAY2. . . . . . .  C ADDR   005CH   A   
STAY3. . . . . . .  C ADDR   0070H   A   
STAY4. . . . . . .  C ADDR   00B9H   A   
STAY5. . . . . . .  C ADDR   00C5H   A   
STAY_AVG . . . . .  C ADDR   008BH   A   
STAY_AVG1. . . . .  C ADDR   0097H   A   
STAY_END . . . . .  C ADDR   009DH   A   
STAY_MIDDLE. . . .  C ADDR   00CFH   A   
TH1. . . . . . . .  D ADDR   008DH   A   
TI . . . . . . . .  B ADDR   0098H.1 A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR1. . . . . . . .  B ADDR   0088H.6 A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
