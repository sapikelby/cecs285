A51 MACRO ASSEMBLER  PROJECT1                                                             03/28/2014 10:59:54 PAGE     1


MACRO ASSEMBLER A51 V8.02b
OBJECT MODULE PLACED IN project1.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE project1.a51 SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ; ----- Kelby Sapien
                       2     ; ----- Project 2
  00A7                 3                     FLAG BIT P2.7
                       4                     ;LED EQU P1
                       5                     
0000                   6                     ORG 0000H
                       7                     ;MOV TMOD, #01H ;TIMER 0 MODE 1
0000 020016            8                     LJMP MAIN0
                       9                     
0003                  10                     ORG 0003H
0003 C2A7             11                     CLR FLAG
0005 32               12                     RETI
                      13                     
0013                  14                     ORG 0013H
0013 D2A7             15                     SETB FLAG
0015 32               16                     RETI
0016 758901           17     MAIN0:  MOV TMOD, #01H ; TIMER 0 MODE 1
0019 7590FF           18     MAIN:   MOV P1, #0FFH
001C D288             19                     SETB TCON.0
001E C2A7             20                     CLR FLAG
                      21                     ;MOV TMOD, #01H ;TIMER 0 MODE 1
                      22                     
0020 308005           23     AGAIN:  JNB P0.0, CHECK_COUNT   ; JUMP if P0.0 is low, otherwise do bouncing cat
0023 1200BD           24                     LCALL BOUNCING                    ; lower pins have higher priority
0026 80F1             25                     SJMP MAIN
                      26                     
0028                  27     CHECK_COUNT:                                                                               
                                                                                                              
0028 308105           28                     JNB P0.1, CHECK_DB  ; JUMP if P0.1 is low, otherwise do counting
002B 12006F           29                     LCALL COUNT
002E 80E9             30                     SJMP MAIN                 ; AT EACH BRANCH, YOU WANT TO GO BACK TO AGAIN AN
                             D CHECK FOR PIN PRIORITY
                      31     
0030                  32     CHECK_DB:
0030 308205           33                     JNB P0.2, CHECK_CYC ; JUMP if P0.2 is low, otherwise do double_bounce
0033 120084           34                     LCALL DOUBLE_BOUNCE
0036 80E1             35                     SJMP MAIN
                      36     
0038                  37     CHECK_CYC: 
0038 308305           38                     JNB P0.3, ERR   ; JUMP if P0.3 is low to error state, otherwise do cyclic m
                             ode
003B 12004F           39                     LCALL CYCLIC
003E 80D9             40                     SJMP MAIN
                      41     
0040                  42     ERR:    ; IF ALL PINS ARE OFF, THEN JUST FLASH THEM                                        
                                                                                                                                       
0040 7590FF           43                     MOV P1,#0FFH
0043 1200DC           44                     LCALL DELAY
0046 759000           45                     MOV P1, #0
0049 1200DC           46                     LCALL DELAY
004C 020019           47                     LJMP MAIN
                      48     
                      49     ; ---- CYCLIC MODE
004F                  50     CYCLIC: 
                      51                     ;JB P0.0, JUMP2_BOUNCE ; RETURN TO PREVIOUS MODE IF PRESSED
                      52                     ;JB P0.1, COUNT
                      53                     ;JB P0.2, DOUBLE_BOUNCE
                      54                     ;JNB P0.3, CYCLIC_DONE  ; replaced with the interrupt
A51 MACRO ASSEMBLER  PROJECT1                                                             03/28/2014 10:59:54 PAGE     2

004F 20A719           55                     JB FLAG, CYCLIC_DONE
                      56                     ;MOV A, #0H
0052 759000           57                     MOV P1, #0
0055 1200DC           58                     LCALL DELAY
0058 7480             59                     MOV A, #80H
005A 7D08             60                     MOV R5, #8
005C                  61     AGAIN2:         
                      62                     ;JB P0.0, BOUNCING ; RETURN TO PREVIOUS MODE IF PRESSED
                      63                     ;JB P0.1, COUNT
                      64                     ;JB P0.2, DOUBLE_BOUNCE
                      65                     ;JNB P0.3, CYCLIC_DONE ; REPLACED WITH INTERRUPT FLAG
005C 20A70C           66                     JB FLAG, CYCLIC_DONE
005F F590             67                     MOV P1, A
0061 1200DC           68                     LCALL DELAY
0064 FE               69                     MOV R6, A
0065 03               70                     RR A
0066 4E               71                     ORL A, R6
                      72                     ;MOV P1, A
                      73                     ;LCALL DELAY
0067 DDF3             74                     DJNZ R5, AGAIN2
0069 80E4             75                     SJMP CYCLIC
                      76     
006B 22               77     CYCLIC_DONE: RET
                      78     
006C                  79     JUMP2_BOUNCE:
006C 0200BD           80                     LJMP BOUNCING
                      81     
                      82     ;---- COUNTING MODE
006F                  83     COUNT:  
                      84                     ;JB P0.0, BOUNCING
006F 20A711           85                     JB FLAG, C_DONE
0072 759000           86             MOV P1, #0
0075 7BFF             87                     MOV R3, #0FFH
0077                  88     DO_AGAIN:
                      89                     ;JB P0.0, BOUNCING
                      90                     ;JNB P0.1, C_DONE
0077 20A709           91                     JB FLAG, C_DONE
                      92                     ;JNB P0.3, ERR
007A 1200DC           93             LCALL DELAY             
007D 0590             94                     INC P1
007F DBF6             95                     DJNZ R3, DO_AGAIN
0081 8096             96                     SJMP MAIN
0083 22               97     C_DONE: RET
                      98     
                      99     
                     100     ; --- DOUBLE BOUNCE
                     101     ; BE CAREFUL, R1-R3 ARE USED BY DELAY FUNCTION
                     102     ; KEPT GETTING ERRORS B/C OF IT
                     103     ; fix overlap by calling two different loops
0084                 104     DOUBLE_BOUNCE:
                     105                     ;JB P0.0, BOUNCING
                     106                     ;JB P0.1, COUNT ; JUMP BACK TO COUNTING MODE IF P0.1 IS HIGH
                     107                     ;JNB P0.2, D_BOUNCE_DONE
0084 20A735          108                     JB FLAG, D_BOUNCE_DONE
0087 7C80            109                     MOV R4, #80H ; 1000 0000
0089 7D01            110                     MOV R5, #01H ; 0000 0001
008B 7E03            111                     MOV R6, #3 ; COUNTER
                     112             
008D EC              113                     MOV A, R4 ; store initial R1 VAL into A = 1000 0000
                     114                     
008E 4D              115                     ORL A, R5 ; A = 1000 0001
008F F590            116                     MOV P1, A ; DISPLAYS IN P1
0091 1200DC          117                     LCALL DELAY
                     118                     
0094                 119     PART1:
                     120                     ;JB P0.0, BOUNCING
A51 MACRO ASSEMBLER  PROJECT1                                                             03/28/2014 10:59:54 PAGE     3

                     121                     ;JB P0.1, COUNT
                     122                     ;JNB P0.2, D_BOUNCE_DONE
0094 20A725          123                     JB FLAG, D_BOUNCE_DONE          
                     124                     ;CLR A
0097 EC              125                     MOV A, R4 ; A = 1000 0000
0098 03              126                     RR A   ;        A = 0100 0000
0099 FC              127                     MOV R4, A ;R1 = 0100 0000
009A ED              128                     MOV A, R5 ; A = 0000 0001
009B 23              129                     RL A      ; A = 0000 0010
009C FD              130                     MOV R5, A ;R2 = 0000 0010
009D 4C              131                     ORL A, R4 ; R1 OR R2 A = 0100 0010 FIRST RUN
                     132                     ;CJNE A,   ; jump when 10 or 0001 1000
009E F590            133                     MOV P1, A ; DISPLAY
00A0 1200DC          134                     LCALL DELAY
00A3 DEEF            135                     DJNZ R6, PART1
00A5 7E02            136                     MOV R6, #2 ; RESET COUNTER
00A7 8000            137                     SJMP PART2
                     138     
                     139                     
00A9                 140     PART2:
                     141                     ;JB P0.0, BOUNCING
                     142                     ;JB P0.1, COUNT
                     143                     ;JNB P0.2, D_BOUNCE_DONE        
00A9 20A710          144                     JB FLAG, D_BOUNCE_DONE
                     145                     ;CLR A
00AC EC              146                     MOV A, R4 ; A = 1000 0000
00AD 23              147                     RL A   ;        A = 0100 0000
00AE FC              148                     MOV R4, A ;R1 = 0100 0000
00AF ED              149                     MOV A, R5 ; A = 0000 0001
00B0 03              150                     RR A      ; A = 0000 0010
00B1 FD              151                     MOV R5, A ;R2 = 0000 0010
00B2 4C              152                     ORL A, R4 ; R1 OR R2 A = 0100 0010 FIRST RUN
                     153                     ;CJNE A,   ; jump when 10 or 0001 1000
00B3 F590            154                     MOV P1, A ; DISPLAY
00B5 1200DC          155                     LCALL DELAY
00B8 DEEF            156                     DJNZ R6, PART2
00BA 80C8            157                     SJMP DOUBLE_BOUNCE              
                     158                     
                     159     
00BC 22              160     D_BOUNCE_DONE:  RET
                     161     
                     162     ; -- BOUNCING
00BD                 163     BOUNCING:
00BD 7401            164                     MOV A, #01H
00BF 7808            165                     MOV R0, #8
00C1                 166     LEFT:   ;JNB P0.0, B_DONE          ; RETURN IF DONE
00C1 20A717          167                     JB FLAG, B_DONE
00C4 03              168                     RR A
00C5 F590            169                     MOV P1, A
00C7 1200DC          170                     LCALL DELAY
00CA D8F5            171                     DJNZ R0, LEFT ; USE A LOOP TO MOVE 7 POSITIONS
00CC 7806            172                     MOV R0, #6    ; RESET COUNTER
00CE                 173     RIGHT:  ;JNB P0.0, B_DONE          ; RETURN IF DONE
00CE 20A70A          174                     JB FLAG, B_DONE
00D1 23              175                     RL A
00D2 F590            176                     MOV P1, A
                     177                     
00D4 1200DC          178                     LCALL DELAY
00D7 D8F5            179                     DJNZ R0, RIGHT
00D9 80E2            180                     SJMP BOUNCING ; REPEAT THE WHOLE SEQUENCE AGAIN
00DB 22              181     B_DONE: RET
                     182     
                     183     
                     184     ; -----------DELAY FUNCTION
00DC                 185     DELAY:
                     186                     ;MOV R7, #10
A51 MACRO ASSEMBLER  PROJECT1                                                             03/28/2014 10:59:54 PAGE     4

                     187                     ;MOV R3, #220
                     188     
00DC                 189     HALF_SEC_CHK:                            ; LOWER PINS HAVE HIGHER PRIORITY
00DC 308404          190                     JNB P0.4, ONE_SEC_CHK   
00DF 7F0A            191                     MOV R7, #10  
00E1 8019            192                     SJMP DLY
                     193     
00E3                 194     ONE_SEC_CHK:    
00E3 308504          195                     JNB P0.5, ONE_HALF_CHK  
00E6 7F14            196                     MOV R7, #20       
00E8 8012            197                     SJMP DLY
                     198     
00EA                 199     ONE_HALF_CHK:   
00EA 308604          200                     JNB P0.6, TWO_SEC_CHK   
00ED 7F1E            201                     MOV R7, #30  
00EF 800B            202                     SJMP DLY
00F1                 203     TWO_SEC_CHK:    
00F1 308704          204                     JNB P0.7, ERR_DELAY     
00F4 7F28            205                     MOV R7, #40       
00F6 8004            206                     SJMP DLY
                     207     
00F8                 208     ERR_DELAY:
00F8 7F0A            209                     MOV R7, #10
                     210                     ;LCALL DLY
00FA 8000            211                     SJMP DLY
                     212                      
                     213     
00FC                 214     DLY:
                     215     
00FC 758A00          216     WAIT: MOV TL0, #0;load initial counting value
00FF 758C4C          217           MOV TH0, #4CH;
0102 D28C            218           SETB TR0;turn on T0
0104 308DFD          219     HERE: JNB TF0, HERE;wait for timer 0 to overflow
0107 C28C            220           CLR TR0 ;turn off timer 0
0109 C28D            221           CLR TF0 ;clear TF0 as interrupt is not used, 
                     222             ;it will not be cleared by hardware.
010B DFEF            223           DJNZ R7, WAIT
010D 22              224               RET
                     225               ;LJMP DELAY
                     226           END
                             ;DLY0:          MOV  R1, #0FFH
                             ;DLY1:          MOV  R2, #0FFH
                             ;DLY2:          DJNZ R2, DLY2
                             ;               DJNZ R1, DLY1
                             ;        DJNZ R3, DLY0
                             ;               DJNZ R7, DLY ; DO THE WHOLE LOOP AGAIN  
                             ;               RET
                             ;               END      
                             ; -- DELAY FUNCTION ENDS
A51 MACRO ASSEMBLER  PROJECT1                                                             03/28/2014 10:59:54 PAGE     5

SYMBOL TABLE LISTING
------ ----- -------


N A M E             T Y P E  V A L U E   ATTRIBUTES

AGAIN. . . . . . .  C ADDR   0020H   A   
AGAIN2 . . . . . .  C ADDR   005CH   A   
BOUNCING . . . . .  C ADDR   00BDH   A   
B_DONE . . . . . .  C ADDR   00DBH   A   
CHECK_COUNT. . . .  C ADDR   0028H   A   
CHECK_CYC. . . . .  C ADDR   0038H   A   
CHECK_DB . . . . .  C ADDR   0030H   A   
COUNT. . . . . . .  C ADDR   006FH   A   
CYCLIC . . . . . .  C ADDR   004FH   A   
CYCLIC_DONE. . . .  C ADDR   006BH   A   
C_DONE . . . . . .  C ADDR   0083H   A   
DELAY. . . . . . .  C ADDR   00DCH   A   
DLY. . . . . . . .  C ADDR   00FCH   A   
DOUBLE_BOUNCE. . .  C ADDR   0084H   A   
DO_AGAIN . . . . .  C ADDR   0077H   A   
D_BOUNCE_DONE. . .  C ADDR   00BCH   A   
ERR. . . . . . . .  C ADDR   0040H   A   
ERR_DELAY. . . . .  C ADDR   00F8H   A   
FLAG . . . . . . .  B ADDR   00A0H.7 A   
HALF_SEC_CHK . . .  C ADDR   00DCH   A   
HERE . . . . . . .  C ADDR   0104H   A   
JUMP2_BOUNCE . . .  C ADDR   006CH   A   
LEFT . . . . . . .  C ADDR   00C1H   A   
MAIN . . . . . . .  C ADDR   0019H   A   
MAIN0. . . . . . .  C ADDR   0016H   A   
ONE_HALF_CHK . . .  C ADDR   00EAH   A   
ONE_SEC_CHK. . . .  C ADDR   00E3H   A   
P0 . . . . . . . .  D ADDR   0080H   A   
P1 . . . . . . . .  D ADDR   0090H   A   
P2 . . . . . . . .  D ADDR   00A0H   A   
PART1. . . . . . .  C ADDR   0094H   A   
PART2. . . . . . .  C ADDR   00A9H   A   
RIGHT. . . . . . .  C ADDR   00CEH   A   
TCON . . . . . . .  D ADDR   0088H   A   
TF0. . . . . . . .  B ADDR   0088H.5 A   
TH0. . . . . . . .  D ADDR   008CH   A   
TL0. . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . .  B ADDR   0088H.4 A   
TWO_SEC_CHK. . . .  C ADDR   00F1H   A   
WAIT . . . . . . .  C ADDR   00FCH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
